<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KiÅŸilik Testi AkÄ±ÅŸ Testi</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #d4af37;
        }
        .status {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            margin: 8px 0;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .profile-result {
            background: linear-gradient(135deg, #d4af37, #b8860b);
            color: white;
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
        }
        .test-button {
            background: linear-gradient(135deg, #d4af37, #b8860b);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 8px 8px 8px 0;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 8px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª KiÅŸilik Testi AkÄ±ÅŸ KontrolÃ¼</h1>
    
    <div class="test-section">
        <h2>ğŸ“ Test SenaryolarÄ±</h2>
        <p>Bu test sayfasÄ±, kiÅŸilik testi tamamlandÄ±ktan sonra verinin nasÄ±l iÅŸlendiÄŸini kontrol eder.</p>
        
        <button class="test-button" onclick="testPersonalityFlow()">ğŸš€ Tam AkÄ±ÅŸÄ± Test Et</button>
        <button class="test-button" onclick="testStorageFlow()">ğŸ’¾ Veri Saklama Test Et</button>
        <button class="test-button" onclick="testAIPersonalization()">ğŸ¤– AI KiÅŸiselleÅŸtirme Test Et</button>
        <button class="test-button" onclick="clearTestData()">ğŸ§¹ Test Verilerini Temizle</button>
    </div>

    <div class="test-section">
        <h2>1ï¸âƒ£ KiÅŸilik Profili OluÅŸturma Testi</h2>
        <div id="profile-test-result"></div>
    </div>

    <div class="test-section">
        <h2>2ï¸âƒ£ Firebase Saklama Testi</h2>
        <div id="storage-test-result"></div>
    </div>

    <div class="test-section">
        <h2>3ï¸âƒ£ AI KiÅŸiselleÅŸtirme Testi</h2>
        <div id="ai-test-result"></div>
    </div>

    <div class="test-section">
        <h2>4ï¸âƒ£ Onboarding Durumu Testi</h2>
        <div id="onboarding-test-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” Mevcut KullanÄ±cÄ± Durumu</h2>
        <div id="current-status"></div>
    </div>

    <script>
        // Test verilerini simÃ¼le eden Ã¶rnek profil
        const samplePersonalityProfile = {
            personalityType: 'luxury_seeker',
            budgetRange: 'luxury',
            travelStyle: 'relaxation',
            durationPreference: '7-10',
            priorities: ['maximum_comfort', 'luxury_lifestyle', 'relaxation'],
            socialMediaStyle: 'luxury_lifestyle',
            energyStyle: 'relaxation',
            mainPriority: 'maximum_comfort',
            aiPersonality: 'sophisticated, elegant, exclusive language. Focus on premium experiences, VIP services, and bespoke recommendations. Use terms like \'curated\', \'exclusive\', \'premium\'. Emphasize premium quality, exclusive experiences, and high-end services.',
            profileScore: 95
        };

        // Test fonksiyonlarÄ±
        async function testPersonalityFlow() {
            const resultDiv = document.getElementById('profile-test-result');
            resultDiv.innerHTML = '<div class="status info">ğŸ”„ KiÅŸilik profili oluÅŸturma test ediliyor...</div>';

            try {
                // Profil oluÅŸturma simÃ¼lasyonu
                const testResult = validatePersonalityProfile(samplePersonalityProfile);
                
                if (testResult.isValid) {
                    resultDiv.innerHTML = `
                        <div class="status success">âœ… KiÅŸilik profili baÅŸarÄ±yla oluÅŸturuldu!</div>
                        <div class="profile-result">
                            <h4>ğŸ“Š OluÅŸturulan Profil:</h4>
                            <p><strong>KiÅŸilik Tipi:</strong> ${samplePersonalityProfile.personalityType}</p>
                            <p><strong>BÃ¼tÃ§e:</strong> ${samplePersonalityProfile.budgetRange}</p>
                            <p><strong>Seyahat Stili:</strong> ${samplePersonalityProfile.travelStyle}</p>
                            <p><strong>SÃ¼re Tercihi:</strong> ${samplePersonalityProfile.durationPreference} gÃ¼n</p>
                            <p><strong>Ana Ã–ncelik:</strong> ${samplePersonalityProfile.mainPriority}</p>
                            <p><strong>Profil Skoru:</strong> ${samplePersonalityProfile.profileScore}/100</p>
                        </div>
                        <div class="status success">ğŸ¯ AI kiÅŸiselleÅŸtirme prompta hazÄ±r!</div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">âŒ Profil doÄŸrulama hatasÄ±: ${testResult.errors.join(', ')}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ Test hatasÄ±: ${error.message}</div>`;
            }
        }

        async function testStorageFlow() {
            const resultDiv = document.getElementById('storage-test-result');
            resultDiv.innerHTML = '<div class="status info">ğŸ”„ Veri saklama test ediliyor...</div>';

            try {
                // LocalStorage ile test (Firebase simÃ¼lasyonu)
                const testUserId = 'test-user-' + Date.now();
                
                // Profil kaydetme simÃ¼lasyonu
                localStorage.setItem(`personality-profile-${testUserId}`, JSON.stringify({
                    ...samplePersonalityProfile,
                    completedAt: new Date().toISOString(),
                    userId: testUserId
                }));

                // KayÄ±t doÄŸrulama
                const savedProfile = localStorage.getItem(`personality-profile-${testUserId}`);
                
                if (savedProfile) {
                    const parsedProfile = JSON.parse(savedProfile);
                    resultDiv.innerHTML = `
                        <div class="status success">âœ… Profil baÅŸarÄ±yla kaydedildi!</div>
                        <div class="status info">ğŸ“… KayÄ±t ZamanÄ±: ${parsedProfile.completedAt}</div>
                        <div class="status info">ğŸ‘¤ KullanÄ±cÄ± ID: ${parsedProfile.userId}</div>
                        <div class="code-block">Firebase Veri YapÄ±sÄ±:<br>
users/${testUserId}/profileData/personalityProfile: ${JSON.stringify(parsedProfile, null, 2)}</div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="status error">âŒ Profil kaydedilemedi!</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ Saklama hatasÄ±: ${error.message}</div>`;
            }
        }

        async function testAIPersonalization() {
            const resultDiv = document.getElementById('ai-test-result');
            resultDiv.innerHTML = '<div class="status info">ğŸ”„ AI kiÅŸiselleÅŸtirme test ediliyor...</div>';

            try {
                // AI prompt oluÅŸturma
                const aiPrompt = generateAISystemPrompt(samplePersonalityProfile);
                
                // Ã–rnek AI yanÄ±tlarÄ± simÃ¼lasyonu
                const testMessages = [
                    "BalayÄ± iÃ§in Ã¶neriniz var mÄ±?",
                    "BÃ¼tÃ§emize uygun paketler hangileri?",
                    "Romantik yerler Ã¶ner"
                ];

                const personalizedResponses = testMessages.map(msg => 
                    generatePersonalizedResponse(msg, samplePersonalityProfile)
                );

                resultDiv.innerHTML = `
                    <div class="status success">âœ… AI kiÅŸiselleÅŸtirme aktif!</div>
                    <div class="profile-result">
                        <h4>ğŸ¤– OluÅŸturulan AI Prompt:</h4>
                        <div class="code-block">${aiPrompt.substring(0, 300)}...</div>
                    </div>
                    <div class="status success">ğŸ’¬ KiÅŸiselleÅŸtirilmiÅŸ YanÄ±t Ã–rnekleri:</div>
                    ${personalizedResponses.map((response, index) => `
                        <div style="margin: 8px 0; padding: 8px; border-left: 3px solid #d4af37; background: #f8f9fa;">
                            <strong>Soru:</strong> ${testMessages[index]}<br>
                            <strong>KiÅŸiselleÅŸtirilmiÅŸ YanÄ±t:</strong> ${response}
                        </div>
                    `).join('')}
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ AI kiÅŸiselleÅŸtirme hatasÄ±: ${error.message}</div>`;
            }
        }

        async function clearTestData() {
            // Test verilerini temizle
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('personality-profile-test-')) {
                    localStorage.removeItem(key);
                }
            });
            
            document.querySelectorAll('[id$="-test-result"]').forEach(div => {
                div.innerHTML = '<div class="status info">ğŸ§¹ Test verileri temizlendi</div>';
            });
        }

        // YardÄ±mcÄ± fonksiyonlar
        function validatePersonalityProfile(profile) {
            const errors = [];
            
            if (!profile.personalityType) errors.push('KiÅŸilik tipi eksik');
            if (!profile.budgetRange) errors.push('BÃ¼tÃ§e aralÄ±ÄŸÄ± eksik');
            if (!profile.travelStyle) errors.push('Seyahat stili eksik');
            if (!profile.durationPreference) errors.push('SÃ¼re tercihi eksik');
            if (!profile.aiPersonality) errors.push('AI kiÅŸiliÄŸi eksik');
            
            return {
                isValid: errors.length === 0,
                errors
            };
        }

        function generateAISystemPrompt(profile) {
            return `You are AI LOVVE, a specialized honeymoon planning assistant. Based on the user's personality profile, adapt your communication style and recommendations accordingly.

USER PERSONALITY PROFILE:
- Type: ${profile.personalityType}
- Budget Range: ${profile.budgetRange}
- Travel Style: ${profile.travelStyle}
- Duration Preference: ${profile.durationPreference} days
- Main Priority: ${profile.mainPriority}
- Social Media Style: ${profile.socialMediaStyle}
- Energy Style: ${profile.energyStyle}

COMMUNICATION STYLE: ${profile.aiPersonality}

IMPORTANT GUIDELINES:
1. Always align your tone and recommendations with the user's personality type
2. Respect their budget range when suggesting packages
3. Prioritize their main values (${profile.mainPriority})
4. Suggest experiences that match their travel style (${profile.travelStyle})
5. Keep recommendations within their preferred duration (${profile.durationPreference} days)
6. Use language and examples that resonate with their social media style
7. Match their energy level preferences when suggesting activities

Remember: You're not just recommending packages, you're creating a personalized experience that feels tailored specifically for them.`;
        }

        function generatePersonalizedResponse(userMessage, profile) {
            const responses = {
                luxury_seeker: {
                    "BalayÄ± iÃ§in Ã¶neriniz var mÄ±?": "Size Ã¶zel, VIP deneyimlerle dolu premium balayÄ± paketlerimizi Ã¶neriyorum. LÃ¼ks resort'larda private suite'ler ve kiÅŸisel butler hizmeti ile unutulmaz anlar yaÅŸayabilirsiniz.",
                    "BÃ¼tÃ§emize uygun paketler hangileri?": "60-100kâ‚º bÃ¼tÃ§enize uygun luxury segmentimizde mÃ¼kemmel seÃ§enekler var. Premium kalite hiÃ§ taviz vermeden, size layÄ±k VIP deneyimler sunuyoruz.",
                    "Romantik yerler Ã¶ner": "Santorini'de private villa, Maldivler'de water villa veya Dubai'de luxury suite - hepsi private deneyimler ve premium hizmetlerle."
                },
                adventure_lover: {
                    "BalayÄ± iÃ§in Ã¶neriniz var mÄ±?": "Heyecan dolu maceralarla balayÄ±nÄ±zÄ± unutulmaz kÄ±lalÄ±m! Trekking, dalÄ±ÅŸ, paragliding - adrenalin dolu aktivitelerle dolu paketlerimiz var.",
                    "BÃ¼tÃ§emize uygun paketler hangileri?": "Macera dolu deneyimlerin tadÄ±nÄ± Ã§Ä±karabileceÄŸiniz, aktif tatil paketlerimizle bÃ¼tÃ§enize uygun seÃ§enekler sunuyoruz.",
                    "Romantik yerler Ã¶ner": "Nepal'de Everest trekking'i, Costa Rica'da zipline, Yeni Zelanda'da bungee jumping - birlikte yaÅŸayacaÄŸÄ±nÄ±z adrenalin dolu romantizm!"
                },
                romantic_dreamer: {
                    "BalayÄ± iÃ§in Ã¶neriniz var mÄ±?": "AÅŸkÄ±nÄ±zÄ± perÃ§inleyecek en romantik anlarÄ± yaÅŸamanÄ±z iÃ§in Ã¶zel paketlerimiz var. GÃ¼n batÄ±mÄ± yemekleri, Ã§ift masajlarÄ± ve romantik sÃ¼prizlerle.",
                    "BÃ¼tÃ§emize uygun paketler hangileri?": "Romantik anlarÄ±n paha biÃ§ilemez olduÄŸunu biliyoruz. BÃ¼tÃ§enize uygun romantik paketlerimizle kalp kalbe anlar yaÅŸayabilirsiniz.",
                    "Romantik yerler Ã¶ner": "Paris'te Seine nehri Ã¼zerinde yemek, Venedik'te gondol turu, Santorini'de gÃ¼n batÄ±mÄ± - aÅŸkÄ±nÄ±zÄ± taÃ§landÄ±racak yerler."
                }
            };
            
            return responses[profile.personalityType]?.[userMessage] || 
                   "Size Ã¶zel tavsiyelerimu yakÄ±nda hazÄ±rlayacaÄŸÄ±m, kiÅŸilik profilinize gÃ¶re en uygun Ã¶nerileri sunacaÄŸÄ±m.";
        }

        // Sayfa yÃ¼klendiÄŸinde mevcut durumu kontrol et
        window.onload = function() {
            const statusDiv = document.getElementById('current-status');
            const isLoggedIn = localStorage.getItem('currentUser') !== null;
            const hasPersonalityProfile = Object.keys(localStorage).some(key => 
                key.startsWith('personality-profile-')
            );
            
            statusDiv.innerHTML = `
                <div class="status ${isLoggedIn ? 'success' : 'warning'}">
                    ğŸ‘¤ KullanÄ±cÄ± Durumu: ${isLoggedIn ? 'GiriÅŸ YapÄ±lmÄ±ÅŸ' : 'GiriÅŸ YapÄ±lmamÄ±ÅŸ'}
                </div>
                <div class="status ${hasPersonalityProfile ? 'success' : 'warning'}">
                    ğŸ§  KiÅŸilik Profili: ${hasPersonalityProfile ? 'TamamlanmÄ±ÅŸ' : 'TamamlanmamÄ±ÅŸ'}
                </div>
                <div class="status info">
                    ğŸ”— Test URL'si: <a href="/test/personality" target="_blank">/test/personality</a>
                </div>
                <div class="status info">
                    ğŸ  Ana Sayfa: <a href="/" target="_blank">/</a>
                </div>
            `;

            // Otomatik test baÅŸlat
            setTimeout(() => {
                document.getElementById('onboarding-test-result').innerHTML = `
                    <div class="status info">ğŸ“‹ Onboarding AkÄ±ÅŸÄ± KontrolÃ¼:</div>
                    <div style="margin: 8px 0;">
                        <strong>1.</strong> KullanÄ±cÄ± giriÅŸ yapÄ±yor â†’ AuthContext loading: false<br>
                        <strong>2.</strong> personalityService.hasCompletedOnboarding() kontrolÃ¼<br>
                        <strong>3.</strong> needsOnboarding: ${!hasPersonalityProfile ? 'true' : 'false'}<br>
                        <strong>4.</strong> ${!hasPersonalityProfile ? 'PersonalityOnboarding gÃ¶steriliyor' : 'Ana sayfa gÃ¶steriliyor'}<br>
                        <strong>5.</strong> Test tamamlandÄ±ktan sonra â†’ onComplete() â†’ profil kaydediliyor<br>
                        <strong>6.</strong> needsOnboarding: false â†’ Ana sayfa yÃ¶nlendirme
                    </div>
                    <div class="status ${!hasPersonalityProfile ? 'warning' : 'success'}">
                        ${!hasPersonalityProfile ? 'âš ï¸ KullanÄ±cÄ± onboarding gÃ¶rmelidir' : 'âœ… KullanÄ±cÄ± ana sayfayÄ± gÃ¶rmelidir'}
                    </div>
                `;
            }, 1000);
        };
    </script>
</body>
</html>